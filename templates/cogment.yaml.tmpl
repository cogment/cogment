{{ $config := . -}}
import:
  proto:
    - data.proto

commands:
  generate: >
    cogment generate --python_dir=./environment &&
    {{- range .ActorClasses }}
      {{- if $config.HasAiByActorClass .Id -}}cogment generate --python_dir=./{{.Id|snakeify}} && {{- end }}
    {{ end -}}
    cogment generate --python_dir=./client
  build: docker-compose build
  # Start and stop services
  start: docker-compose up orchestrator environment {{- range .ActorClasses}} {{- if $config.HasAiByActorClass .Id }} {{.Id|kebabify}}{{end}}{{end}}
  stop: docker-compose stop orchestrator environment {{- range .ActorClasses}} {{- if $config.HasAiByActorClass .Id }} {{.Id|kebabify}}{{end}}{{end}}
  client: docker-compose run --rm client

environment:
  config_type: {{.ProjectName|snakeify}}.EnvConfig

trial:
  config_type: {{.ProjectName|snakeify}}.TrialConfig

# Static configuration
actor_classes:
{{- range .ActorClasses }}
  - id: {{.Id|snakeify}}
    action:
      space: {{$config.ProjectName|snakeify}}.{{.Id|pascalify}}Action
    observation:
      space: {{$config.ProjectName|snakeify}}.Observation
{{- end}}

# Dynamic configuration (could be changed by a pre-hook)
trial_params:
  environment:
    endpoint: grpc://environment:9000
    #config: {}
  actors:
  {{- range .TrialParams.Actors}}
    - actor_class: {{.ActorClass|snakeify}}
      endpoint: {{.Endpoint}}
  {{- end }}
